<!DOCTYPE html>
<html>
<head>
    <link rel='stylesheet' href='https://unpkg.com/maplibre-gl@5.12.0/dist/maplibre-gl.css' />
    <script src='https://unpkg.com/maplibre-gl@5.12.0/dist/maplibre-gl.js'></script>
    <style>
        body { 
            margin: 0; 
            padding: 0}
        #map {
            width: 50%;
            height: 500px;
            margin: auto;
        }
        .color-box.good {
            background-color: #00E400;
        }
        h1{
            padding: 10px;
            font: bold 50px "Roboto Condensed",sans-serif 
        }
        h2{
            padding: 10px;        
            font: bold 30px "Roboto Condensed",sans-serif 
        }
        h4{
            padding: 10px;
            font: bold 20px "Roboto Condensed",sans-serif 
        }
        p {
            padding: 10px;        
            width:65%;
            font:15px "Roboto Condensed",sans-serif 

        }
        label{
            padding: 10px;  
            font:bold 15px "Roboto Condensed",sans-serif 
 
        }
        .map-legend{
            padding: 10px;        

        }
        li{
            width:65%;

            font: 15px "Roboto Condensed",sans-serif 


        }
    </style>
</head>
<body>
    <h1>Smog City</h1>
    <p> 
        According to the 6th Annual World Air Quality Report, Pakistan was ranked as the second most polluted country in the world, with PM2.5 concentrations approximately 14 times higher than the World Health Organization (WHO) guideline levels (IQAir, 2024). More specifically, Lahore is the second most polluted city in the world (IQAir). Through this project I want to explore how the air quality index (AQI) has changed over time in Lahore and how it changes across different seasons (months).    </p>
        <h4> How is air quality measured?</h4>
    <p> 
        Each circle on the map represents an air quality monitoring station and shows its average monthly value. These values use the U.S. Air Quality Index (AQI).
        Air quality is reported using the AQI, which has six categories that indicate the level of health concern, each represented by a specific color. The AQI is calculated based on measurements of: Particulate matter (PM2.5 and PM10), Ozone, Nitrogen dioxide, Sulfur dioxide, Carbon monoxide.
          
    </p>
<h2>Explore AQI Across Lahore</h2>
    <label  for = 'pick-year'> Pick a year:</label>
    <select name="years" id="pick-year">
        <option value="">--Please choose an option--</option>
        <option value="2018">2018</option>
        <option value="2019">2019</option>
        <option value="2020">2020</option>
        <option value="2021">2021</option>
        <option value="2022">2022</option>
        <option value="2023">2023</option>
        <option value="2024">2024</option>
        <option value="2025">2025</option>
      </select>
    <label id="month" for="slider">Pick a month:</label>
    <input id="slider" type="range" min="0" max="11" step="1" value="0" />
    
    <h4> Map Legend</h4>
    <div class = "map-legend"> 
    <svg width="300" height="60" viewBox="0 0 300 60" xmlns="http://www.w3.org/2000/svg">
        <rect x="0" y="0" width="50" height="60" fill="#478c5c" stroke="black"></rect>
        <text x="25" y="30" font-size="10" font-family="sans-serif" text-anchor="middle" dominant-baseline="middle">
          Good
        </text>
      
        <rect x="50" y="0" width="50" height="60" fill="#fede00" stroke="black"></rect>
        <text x="75" y="30" font-size="10" font-family="sans-serif" text-anchor="middle" dominant-baseline="middle">
          Moderate
        </text>
      
        <rect x="100" y="0" width="50" height="60" fill="#FF7E00" stroke="black"></rect>
        <text font-size="8" font-family="sans-serif" text-anchor="middle" dominant-baseline="middle">
          <tspan x="125" y="25">Unhealthy</tspan>
          <tspan x="125" y="37">for Sensitive</tspan>
        </text>
      
        <rect x="150" y="0" width="50" height="60" fill="#e21b32" stroke="black"></rect>
        <text x="175" y="30" font-size="10" font-family="sans-serif" text-anchor="middle" dominant-baseline="middle">
          Unhealthy
        </text>
      
        <rect x="200" y="0" width="50" height="60" fill="#8F3F97" stroke="black"></rect>
        <text font-size="8" font-family="sans-serif" text-anchor="middle" dominant-baseline="middle">
          <tspan x="225" y="25">Very</tspan>
          <tspan x="225" y="37">Unhealthy</tspan>
        </text>
      
        <rect x="250" y="0" width="50" height="60" fill="#7E0023" stroke="black"></rect>
        <text x="275" y="30" font-size="9" font-family="sans-serif" text-anchor="middle" dominant-baseline="middle" fill="white">
          Hazardous
        </text>
      </svg>
    </div>
                              
    <div id="map"></div>
    <script>
        var map = new maplibregl.Map({
            container: 'map',
            style: 'https://api.maptiler.com/maps/streets-v4/style.json?key=z42CYMIGsRqf1ginH8SF',
            center: [74.3587, 31.5204],
            zoom: 10
        });
        const months = [
            'January',
            'February',
            'March',
            'April',
            'May',
            'June',
            'July',
            'August',
            'September',
            'October',
            'November',
            'December'
        ];
        
        const years = [
            '2016', 
            '2017',
            '2018', 
            '2019', 
            '2020', 
            '2021', 
            '2022', 
            '2023', 
            '2024', 
            '2025'
    
        ]
        
        /*function filterByOctober() {
            map.setFilter('clusters', ['==', ['get', 'month'], 'October']);}*/


        // combine into one function
        function filterBy(month, year){
            const filters = ['all', ['==', ['get', 'month'], month], ['==', ['get', 'year'], year]]
            map.setFilter('clusters', filters)
            document.getElementById('month').textContent = month

        }



        /*function filterByMonth(month) {
            const filters = ['==', 'month', month];
            map.setFilter('clusters', filters);
        // Set the label to the month
        document.getElementById('month').textContent = month;
    }
        function filterByYear(year){
            const filters = ['==', 'year', year];
            map.setFilter('clusters', filters)
        }*/

        map.on('load', () =>{
            map.addSource('aqi_monitors', {
                type: 'geojson', 
                data: 'data/aqi_lhe_data.geojson'

            });

        map.addLayer({
            id:'clusters',
            type: 'circle', 
            source: 'aqi_monitors', 
            paint: {
        'circle-radius': 12,
        'circle-color': [
            'match',
            ['downcase', ['get', 'aqi_cat']],
            'good', '#478c5c',
            'moderate', '#fede00',
            'unhealthy for sensitive groups', '#FF7E00',
            'unhealthy', '#e21b32',
            'very unhealthy', '#8F3F97',
            'hazardous', '#7E0023',
            '#bddee8']
           }});

        // caled when the slider or the drop down is moved   
        function monthYearHandler(){
            const month = document.getElementById('slider').value
            const monthName = months[month]
            const year = document.getElementById('pick-year').value
            filterBy(monthName, year)
        }
        
        // whenever there is an input event on the slider or drop down then call the function
        document.getElementById('slider').addEventListener('input', monthYearHandler);

        document.getElementById('pick-year').addEventListener('input', monthYearHandler)


        
});
    </script>

    <h2>Explore Emissions By Sector</h2>
    <p> In response to worsening air quality, the Punjab government has implemented various policy tools, though many have proven ineffective or poorly designed. For example, in 2023, the government resorted to smart lockdowns, mandating the temporary closure of schools, offices, and businesses to reduce vehicular emissions. However, this approach mirrored the province's earlier COVID 19 lockdown strategy rather than a targeted environmental intervention. The policy ultimately failed to achieve its goals, as many citizens treated the shutdown as a "long weekend" and continued to drive to social gatherings.
        Moreover, the policy was met with strong opposition from restaurant owners and small businesses, who argued that the true culprits were large industrial manufacturers and unregulated factories emitting significant pollutants. This raises several important questions:
    </p>
<ol>
  <li>
    What regulatory strategies has the federal government implemented to address factory emissions?
  </li>
  <li>
    How should the costs of pollution be distributed? Should the focus be on vehicular emissions, industrial polluters, or agricultural practices like crop burning, which remains prevalent among farmers in Punjab?
  </li>
</ol>
    
        <div>
        <embed
        id="inlineFrameExample"
        title="Inline Frame Example"
        width="600"
        height="300"
        src="altair_viz/sector_comparison.html">

    </div>

    <div>
        <embed
id="inlineFrameExample"
title="Inline Frame Example"
width="1000"
height="300"
src="altair_viz/sector_source_comparison.html"> 
</div>




</body>
</html>
